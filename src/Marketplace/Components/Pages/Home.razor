@page "/"
@using Marketplace.Components.Layout
@using MudBlazor
@using System.Globalization
@inject IDialogService DialogService

<div class="dashboard-container">
    @switch (_currentStep)
    {
        case 1:
            @* This is the main dashboard view *@
            <PromotionCarousel/>
            <CategoryCarousel Categories="_categories" OnCategoryClick="HandleCategoryClick" />
            <div class="services-section">
                <div class="d-flex justify-space-between align-center mb-2">
                    <MudText Typo="Typo.h6" Style="font-weight: 700;">Navrhované služby</MudText>
                    <MudIconButton style="color:#0081EC" Icon="@Icons.Material.Filled.FilterList" />
                </div>
                <MudStack Spacing="2">
                    @foreach (var offer in _offers)
                    {
                        <OfferCard Offer="offer" OnOrderClick="HandleOrderClick" />
                    }
                </MudStack>
            </div>
            break;

        case 2:
            @* This shows the ServiceListView for the selected category *@
            <ServiceListView Offers="_offers" 
                             Category="@_selectedCategory"
                             OnBackClick="@(() => SetStep(1))" 
                             OnOrderClick="@(HandleOrderClick)" />
            break;
            
        case 3:
             @* This step is ready for your final Order page *@
            <Order Offer="_selectedOffer" OnBackClick="@(HandleOnBackClick)" />
            break;
    }
</div>

@code {
    private int _currentStep = 1;
    private List<Category> _categories = new();
    private List<Offer> _offers = new();
    private Category _selectedCategory;
    private Offer _selectedOffer;

    private bool _isSearchVisible = false;

    private void ToggleSearch()
    {
        _isSearchVisible = !_isSearchVisible;
    }

    public class Category
    {
        public string Name { get; set; }
        public string IconSvg { get; set; }
        public string BackgroundColor { get; set; }
        public string[] Filters { get; set; }
    }

    public class Offer
    {
        public string Title { get; set; }
        public string Provider { get; set; }
        public string Category { get; set; }
        public string SubCategory { get; set; }
        public string Description {get; set;} = "Description";
        public double Rating { get; set; }
        public int RatingCount { get; set; }
        public double DistanceKm { get; set; }
        public string ClosesAt { get; set; }
        public string Price { get; set; }
        public string ImageUrl { get; set; }
    }

    protected override void OnInitialized()
    {
        LoadCategories();
        LoadOffers();
    }

    // This method is called by the child component when a category is clicked.
    private void HandleCategoryClick(Category category)
    {
        _selectedCategory = category;
        SetStep(2);
    }

    // This method will be called when an offer's order button is clicked
    private void HandleOrderClick(Offer offer)
    {
        _selectedOffer = offer;
        SetStep(3);
    }

    private void HandleOnBackClick(Offer offer)
    {
        if (offer == null)
        {
            SetStep(1);
        }
        else
        {
            _selectedOffer = offer;
            SetStep(2);
        }
    }

    private void SetStep(int step)
    {
        _currentStep = step;
        StateHasChanged();
    }

    private async Task ShowComingSoon()
    {
        await DialogService.ShowAsync<ComingSoonDialog>("Funkcia v Príprave");
    }

    private void LoadCategories() => _categories = new List<Category>
    {
        new() { Name = "Auto",
            Filters = new []
            {
                "Výmena pneumatík",
                "Servis",
                "Čistenie",
                "Technická kontrola"
            },
            BackgroundColor = "#1C3C37",
            IconSvg = @"<svg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M19 17H21C21.6 17 22 16.6 22 16V13C22 12.1 21.3 11.3 20.5 11.1C18.7 10.6 16 10 16 10C16 10 14.7 8.6 13.8 7.7C13.3 7.3 12.7 7 12 7H5C4.4 7 3.9 7.4 3.6 7.9L2.2 10.8C2.06758 11.1862 2 11.5917 2 12V16C2 16.6 2.4 17 3 17H5' stroke='#70D0BC' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/><path d='M7 19C8.10457 19 9 18.1046 9 17C9 15.8954 8.10457 15 7 15C5.89543 15 5 15.8954 5 17C5 18.1046 5.89543 19 7 19Z' stroke='#70D0BC' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/><path d='M9 17H15' stroke='#70D0BC' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/><path d='M17 19C18.1046 19 19 18.1046 19 17C19 15.8954 18.1046 15 17 15C15.8954 15 15 15.8954 15 17C15 18.1046 15.8954 19 17 19Z' stroke='#70D0BC' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>" 
        },
        new() { Name = "Domácnosť",
            Filters = new []
            {
                "Upratovanie",
                "Opravy",
                "Sťahovanie",
                "Záhradnícke služby"
            },
            BackgroundColor = "#4B3F18",
            IconSvg = @"<svg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M18 20V12C18 11.7348 17.8946 11.4804 17.7071 11.2929C17.5196 11.1054 17.2652 11 17 11H13C12.7348 11 12.4804 11.1054 12.2929 11.2929C12.1054 11.4804 12 11.7348 12 12V20' stroke='#D5BF68' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/><path d='M6 10C6 9.70905 6.06304 9.42173 6.18561 9.15772C6.30819 8.89371 6.48734 8.65975 6.70938 8.472L12.7094 3.473C13.0695 3.16792 13.5266 3.00049 13.9994 3.00049C14.4721 3.00049 14.9292 3.16792 15.2894 3.473L21.2894 8.472C21.5114 8.65975 21.6906 8.89371 21.8131 9.15772C21.9357 9.42173 21.9987 9.70905 21.9987 10V19C21.9987 19.5305 21.788 20.0392 21.4129 20.4142C21.0379 20.7893 20.5293 21 19.9987 21H8.00125C7.47071 21 6.96207 20.7893 6.58705 20.4142C6.21203 20.0392 6.00125 19.5305 6.00125 19V10' stroke='#D5BF68' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>" 
        },
        new() { Name = "Technológie",
            Filters = new []
            {
                "Oprava počítačov",
                "Inštalácia softvéru",
                "Nastavenie siete",
                "Poradenstvo"
            },
            BackgroundColor = "#2D1F42",
            IconSvg = @"<svg width='24' height='24' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M20.054 15.987H3.94602M18 5C18.5305 5 19.0392 5.21071 19.4142 5.58579C19.7893 5.96086 20 6.46957 20 7V15.526C19.9999 15.8374 20.0725 16.1446 20.212 16.423L21.28 18.55C21.3571 18.703 21.3936 18.8732 21.386 19.0444C21.3784 19.2155 21.327 19.3818 21.2366 19.5274C21.1463 19.6729 21.0201 19.7928 20.8701 19.8756C20.7201 19.9584 20.5513 20.0012 20.38 20H3.62002C3.44871 20.0012 3.27997 19.9584 3.12997 19.8756C2.97997 19.7928 2.85374 19.6729 2.7634 19.5274C2.67305 19.3818 2.62162 19.2155 2.61402 19.0444C2.60643 18.8732 2.64293 18.703 2.72002 18.55L3.78802 16.423C3.92756 16.1446 4.00016 15.8374 4.00002 15.526V7C4.00002 6.46957 4.21073 5.96086 4.58581 5.58579C4.96088 5.21071 5.46959 5 6.00002 5H18Z' stroke='#7D5CAB' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>" 
        },
        new() { Name = "Krása",
            Filters = new []
            {
                "Kaderníctvo",
                "Kozmetika",
                "Manikúra a pedikúra",
                "Masáže"
            },
            BackgroundColor = "#471D39",
            IconSvg = @"<svg width='22' height='22' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z' stroke='#B7719B' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>" 
        },
        new() { Name = "Zdravie",
            Filters = new []
            {
                "Lekár",
                "Zubár",
                "Fyzioterapia",
                "Psychológ"
            },
            BackgroundColor = "#492D1B",
            IconSvg = @"<svg width='22' height='20' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M18 12C19.49 10.54 21 8.79 21 6.5C21 5.04131 20.4205 3.64236 19.3891 2.61091C18.3576 1.57946 16.9587 1 15.5 1C13.74 1 12.5 1.5 11 3C9.5 1.5 8.26 1 6.5 1C5.04131 1 3.64236 1.57946 2.61091 2.61091C1.57946 3.64236 1 5.04131 1 6.5C1 8.8 2.5 10.55 4 12L11 19L18 12Z' stroke='#B37A4D' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>" 
        },
        new() { Name = "Vzdelávanie",
            Filters = new []
            {
                "Doučovanie",
                "Kurzy",
                "Jazykové školy",
                "Online vzdelávanie"
            },
            BackgroundColor = "#1C2847",
            IconSvg = @"<svg width='22' height='20' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M11 5V19M11 5C11 3.93913 10.5786 2.92172 9.82843 2.17157C9.07828 1.42143 8.06087 1 7 1H2C1.73478 1 1.48043 1.10536 1.29289 1.29289C1.10536 1.48043 1 1.73478 1 2V15C1 15.2652 1.10536 15.5196 1.29289 15.7071C1.48043 15.8946 1.73478 16 2 16H8C8.79565 16 9.55871 16.3161 10.1213 16.8787C10.6839 17.4413 11 18.2044 11 19M11 5C11 3.93913 11.4214 2.92172 12.1716 2.17157C12.9217 1.42143 13.9391 1 15 1H20C20.2652 1 20.5196 1.10536 20.7071 1.29289C20.8946 1.48043 21 1.73478 21 2V15C21 15.2652 20.8946 15.5196 20.7071 15.7071C20.5196 15.8946 20.2652 16 20 16H14C13.2044 16 12.4413 16.3161 11.8787 16.8787C11.3161 17.4413 11 18.2044 11 19' stroke='#476EBB' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>" 
        },
        new() { Name = "Potraviny",
            Filters = new []
            {
                "Donáška",
                "Catering",
                "Farmárske produkty",
                "Špeciality"
            },
            BackgroundColor = "#450E13",
            IconSvg = @"<svg width='22' height='22' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'><path d='M6 10V4H18V10M6 10L4 20H20L18 10M6 10H18' stroke='#C30F48' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/></svg>" 
        }
    };

    private void LoadOffers()
    {
        _offers = new List<Offer>
        {
            // Auto
            new() { Title = "Výmena pneumatík", Provider = "PneuServis Bratislava", Category = "Auto", SubCategory = "Výmena pneumatík", Rating = 4.8, RatingCount = 120, DistanceKm = 2.1, ClosesAt = "17:00", Price = "30 EUR", ImageUrl = "https://images.unsplash.com/photo-1511918984145-48de785d4c4e?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Kompletný servis vozidla", Provider = "AutoExpert", Category = "Auto", SubCategory = "Servis", Rating = 4.7, RatingCount = 98, DistanceKm = 3.4, ClosesAt = "18:00", Price = "od 99 EUR", ImageUrl = "https://images.unsplash.com/photo-1503736334956-4c8f8e92946d?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Čistenie interiéru", Provider = "CleanCar", Category = "Auto", SubCategory = "Čistenie", Rating = 4.9, RatingCount = 210, DistanceKm = 1.5, ClosesAt = "19:00", Price = "25 EUR", ImageUrl = "https://images.unsplash.com/photo-1464983953574-0892a716854b?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Technická kontrola vozidla", Provider = "STK Centrum", Category = "Auto", SubCategory = "Technická kontrola", Rating = 4.6, RatingCount = 75, DistanceKm = 4.2, ClosesAt = "16:00", Price = "50 EUR", ImageUrl = "https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=800&auto=format&fit=crop" },

            // Domácnosť
            new() { Title = "Kompletné upratovanie bytu", Provider = "ČistýDomov", Category = "Domácnosť", SubCategory = "Upratovanie", Rating = 4.8, RatingCount = 180, DistanceKm = 2.0, ClosesAt = "20:00", Price = "40 EUR", ImageUrl = "https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Oprava elektroinštalácie", Provider = "RýchlyMajster", Category = "Domácnosť", SubCategory = "Opravy", Rating = 4.7, RatingCount = 60, DistanceKm = 3.7, ClosesAt = "18:00", Price = "od 25 EUR", ImageUrl = "https://images.unsplash.com/photo-1519125323398-675f0ddb6308?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Sťahovanie bytu", Provider = "Sťahuj.sk", Category = "Domácnosť", SubCategory = "Sťahovanie", Rating = 4.9, RatingCount = 95, DistanceKm = 5.0, ClosesAt = "21:00", Price = "od 60 EUR", ImageUrl = "https://images.unsplash.com/photo-1465101046530-73398c7f28ca?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Záhradnícke služby", Provider = "ZáhradaPro", Category = "Domácnosť", SubCategory = "Záhradnícke služby", Rating = 4.8, RatingCount = 110, DistanceKm = 2.8, ClosesAt = "17:00", Price = "od 20 EUR", ImageUrl = "https://images.unsplash.com/photo-1501004318641-b39e6451bec6?q=80&w=800&auto=format&fit=crop" },

            // Technológie
            new() { Title = "Oprava notebooku", Provider = "TechFix", Category = "Technológie", SubCategory = "Oprava počítačov", Rating = 4.9, RatingCount = 130, DistanceKm = 1.9, ClosesAt = "18:00", Price = "od 35 EUR", ImageUrl = "https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Inštalácia softvéru", Provider = "SoftHelp", Category = "Technológie", SubCategory = "Inštalácia softvéru", Rating = 4.7, RatingCount = 85, DistanceKm = 2.3, ClosesAt = "17:00", Price = "15 EUR", ImageUrl = "https://images.unsplash.com/photo-1517336714731-489689fd1ca8?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Nastavenie WiFi siete", Provider = "NetExpert", Category = "Technológie", SubCategory = "Nastavenie siete", Rating = 4.8, RatingCount = 70, DistanceKm = 3.0, ClosesAt = "19:00", Price = "20 EUR", ImageUrl = "https://images.unsplash.com/photo-1519125323398-675f0ddb6308?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "IT poradenstvo", Provider = "ITConsult", Category = "Technológie", SubCategory = "Poradenstvo", Rating = 4.9, RatingCount = 55, DistanceKm = 2.7, ClosesAt = "18:00", Price = "od 30 EUR", ImageUrl = "https://images.unsplash.com/photo-1461749280684-dccba630e2f6?q=80&w=800&auto=format&fit=crop" },

            // Krása
            new() { Title = "Strih a úprava vlasov", Provider = "HairStyle", Category = "Krása", SubCategory = "Kaderníctvo", Rating = 4.8, RatingCount = 140, DistanceKm = 1.2, ClosesAt = "20:00", Price = "18 EUR", ImageUrl = "https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Kozmetické ošetrenie", Provider = "BeautyCare", Category = "Krása", SubCategory = "Kozmetika", Rating = 4.9, RatingCount = 90, DistanceKm = 2.5, ClosesAt = "19:00", Price = "od 25 EUR", ImageUrl = "https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Manikúra a pedikúra", Provider = "NailStudio", Category = "Krása", SubCategory = "Manikúra a pedikúra", Rating = 4.7, RatingCount = 100, DistanceKm = 1.8, ClosesAt = "18:00", Price = "od 15 EUR", ImageUrl = "https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Relaxačná masáž", Provider = "Masáže Relax", Category = "Krása", SubCategory = "Masáže", Rating = 4.9, RatingCount = 80, DistanceKm = 2.0, ClosesAt = "21:00", Price = "30 EUR", ImageUrl = "https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=800&auto=format&fit=crop" },

            // Zdravie
            new() { Title = "Preventívna prehliadka", Provider = "ZdraviePlus", Category = "Zdravie", SubCategory = "Lekár", Rating = 4.8, RatingCount = 200, DistanceKm = 1.0, ClosesAt = "16:00", Price = "20 EUR", ImageUrl = "https://images.unsplash.com/photo-1519494080410-f9aa8f52f1e1?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Dentálna hygiena", Provider = "SmileDent", Category = "Zdravie", SubCategory = "Zubár", Rating = 4.9, RatingCount = 120, DistanceKm = 2.2, ClosesAt = "17:00", Price = "35 EUR", ImageUrl = "https://images.unsplash.com/photo-1519864600265-abb23847ef2c?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Fyzioterapia chrbta", Provider = "FyzioPro", Category = "Zdravie", SubCategory = "Fyzioterapia", Rating = 4.7, RatingCount = 60, DistanceKm = 3.1, ClosesAt = "18:00", Price = "25 EUR", ImageUrl = "https://images.unsplash.com/photo-1505751172876-fa1923c5c528?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Psychologické poradenstvo", Provider = "PsycheHelp", Category = "Zdravie", SubCategory = "Psychológ", Rating = 4.8, RatingCount = 45, DistanceKm = 2.9, ClosesAt = "19:00", Price = "od 30 EUR", ImageUrl = "https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=800&auto=format&fit=crop" },

            // Vzdelávanie
            new() { Title = "Doučovanie matematiky", Provider = "EduTutor", Category = "Vzdelávanie", SubCategory = "Doučovanie", Rating = 4.9, RatingCount = 70, DistanceKm = 1.7, ClosesAt = "20:00", Price = "15 EUR/hod", ImageUrl = "https://images.unsplash.com/photo-1465101046530-73398c7f28ca?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Kurz programovania", Provider = "CodeAcademy", Category = "Vzdelávanie", SubCategory = "Kurzy", Rating = 4.8, RatingCount = 90, DistanceKm = 2.4, ClosesAt = "21:00", Price = "od 99 EUR", ImageUrl = "https://images.unsplash.com/photo-1519389950473-47ba0277781c?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Anglický jazyk pre deti", Provider = "Jazyková škola", Category = "Vzdelávanie", SubCategory = "Jazykové školy", Rating = 4.7, RatingCount = 60, DistanceKm = 2.8, ClosesAt = "18:00", Price = "od 10 EUR/hod", ImageUrl = "https://images.unsplash.com/photo-1508214751196-bcfd4ca60f91?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Online kurz Excelu", Provider = "OnlineEdu", Category = "Vzdelávanie", SubCategory = "Online vzdelávanie", Rating = 4.9, RatingCount = 110, DistanceKm = 0.0, ClosesAt = "23:59", Price = "49 EUR", ImageUrl = "https://images.unsplash.com/photo-1461749280684-dccba630e2f6?q=80&w=800&auto=format&fit=crop" },

            // Potraviny
            new() { Title = "Donáška obedov", Provider = "FoodExpress", Category = "Potraviny", SubCategory = "Donáška", Rating = 4.8, RatingCount = 150, DistanceKm = 0.5, ClosesAt = "15:00", Price = "od 5 EUR", ImageUrl = "https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Catering na oslavy", Provider = "PartyCatering", Category = "Potraviny", SubCategory = "Catering", Rating = 4.9, RatingCount = 80, DistanceKm = 4.0, ClosesAt = "22:00", Price = "od 100 EUR", ImageUrl = "https://images.unsplash.com/photo-1519125323398-675f0ddb6308?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Farmárske produkty", Provider = "FarmBox", Category = "Potraviny", SubCategory = "Farmárske produkty", Rating = 4.7, RatingCount = 65, DistanceKm = 3.2, ClosesAt = "18:00", Price = "od 10 EUR", ImageUrl = "https://images.unsplash.com/photo-1465101046530-73398c7f28ca?q=80&w=800&auto=format&fit=crop" },
            new() { Title = "Ázijské špeciality", Provider = "AsiaFood", Category = "Potraviny", SubCategory = "Špeciality", Rating = 4.8, RatingCount = 90, DistanceKm = 2.6, ClosesAt = "21:00", Price = "od 7 EUR", ImageUrl = "https://images.unsplash.com/photo-1506744038136-46273834b3fb?q=80&w=800&auto=format&fit=crop" }
        };
    }
}
